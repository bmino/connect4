<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Connect 4</title>
    <link rel="stylesheet" href="style/canvas.css">
</head>
<body>
    <!-- Canvas -->
    <canvas id="master-canvas" width="600" height="600"></canvas>



    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/bmDraw.js"></script>
    <script type="text/javascript">
        var canvas, ctx;

        /* Connect to socket.io */
        var socket = io();

        var gameState = {
            status: 'CONNECTING'
        };

        socket.on('game:host', function(game) {
            console.log('created new game id ' + game.id);
            gameState.id = game.id;
            gameState.status = 'SEARCHING_FOR_OPPONENT';
        });

        socket.on('game:join', function(game) {
            console.log('joined existing game id ' + game.id);
            gameState.id = game.id;
            gameState.status = 'MIGHT_BE_YOUR_MOVE';
        });

        socket.on('game:begin', function() {
            setupBoard();
        });

        socket.on('move:draw', function(move) {
            bmDraw.mark(move.col, move.row);
        });

        function setupBoard() {
            canvas = document.getElementById('master-canvas');
            ctx = canvas.getContext('2d');

            /* Draws Board Grid */
            bmDraw.init(canvas, ctx, 3);

            canvas.addEventListener('click', canvasClick, false);
            function canvasClick(event) {
                var x = event.pageX - canvas.offsetLeft;
                var y = event.pageY - canvas.offsetTop;
                var pos = bmDraw.identifyGridFromMouse(x, y);
                socket.emit('move:make', {
                    game: gameState.id,
                    col: pos.x,
                    row: pos.y
                });
            }
        }

    </script>
</body>
</html>